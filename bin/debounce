#!/usr/bin/env perl

use strict;
use warnings;

$|++;

use IO::Async::Loop;
use IO::Async::Timer::Countdown;
use IO::Async::Stream;

my $time = shift || 1;
my $loop = IO::Async::Loop->new;

my $timer = IO::Async::Timer::Countdown->new(
   delay     => $time,
   on_expire => sub { print "activity!\n"; shift->stop }
);

$loop->add($timer);

my $fs = IO::Async::Stream->new_for_stdin(
   on_read => sub {
      ${$_[1]} = ''; # we don't care what we get

      $timer->start unless $timer->is_running;
      $timer->reset;
   }
);

$loop->add($fs);

$loop->run;
