#!/bin/dash

if [ $# -ne 2 ]; then
  echo "Usage: $0 path/to/file linenumber" 1>&2
  exit 1
fi


file="$1"
line="$2"
newfile="/run/shm/$(basename "$file").munged"

cp "$file" "$newfile"
echo "$line\ni\ntmp\n.\nwq" | ed -s "$newfile" >/dev/null

git diff --no-index "$file" "$newfile" |
   perl -pne 'if (m/^@@ .* @@ (.*)/) { $_ = "$1\n"} else { undef $_ }'

rm "$newfile"

# vim: ft=sh
